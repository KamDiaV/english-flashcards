"use strict";(self.webpackChunkenglish_flashcards=self.webpackChunkenglish_flashcards||[]).push([[774],{774:(t,e,r)=>{r.r(e),r.d(e,{default:()=>R});var s=r(5043),n=r(2555),i=r(9781),o=r(2836),a=r(5207),u=r(4834);const c="\u042d\u0442\u043e \u043f\u043e\u043b\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0434\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f",l="\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u0438\u0435 \u0431\u0443\u043a\u0432\u044b, \u043f\u0440\u043e\u0431\u0435\u043b\u044b, \u0434\u0435\u0444\u0438\u0441\u044b \u0438 \u0430\u043f\u043e\u0441\u0442\u0440\u043e\u0444\u044b",d="\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0435 \u0441\u0438\u043c\u0432\u043e\u043b\u044b \u0442\u0440\u0430\u043d\u0441\u043a\u0440\u0438\u043f\u0446\u0438\u0438",h="\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0440\u0443\u0441\u0441\u043a\u0438\u0435 \u0431\u0443\u043a\u0432\u044b, \u043f\u0440\u043e\u0431\u0435\u043b\u044b \u0438 \u0434\u0435\u0444\u0438\u0441\u044b",p=t=>"\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430 ".concat(t," \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),m=t=>"\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0434\u043b\u0438\u043d\u0430 ".concat(t," \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432"),f={ENGLISH_WORD:/^[A-Za-z\s'-]+$/,TRANSCRIPTION:/^[a-zA-Z\u0250-\u02AF\u02C8\u02CC\u02D0\s'\u02d0\u02c8\u02cc]+$/,RUSSIAN_WORD:/^[\u0410-\u042f\u0430-\u044f\u0401\u0451\s-]+$/},_={required:t=>t&&t.trim()?null:c,englishWord:t=>t&&t.trim()&&!f.ENGLISH_WORD.test(t)?l:null,transcription:t=>{if(!t||!t.trim())return null;const e=t.replace(/\[|\]/g,"");return f.TRANSCRIPTION.test(e)?null:d},russianWord:t=>t&&t.trim()&&!f.RUSSIAN_WORD.test(t)?h:null,minLength:t=>e=>!e||!e.trim()||e.length>=t?null:p(t),maxLength:t=>e=>!e||!e.trim()||e.length<=t?null:m(t)};const b={form:"AddWordForm_form__3YoZc",field:"AddWordForm_field__CR9-8",input:"AddWordForm_input__GQ-nM",errorInput:"AddWordForm_errorInput__4f3O7",caption:"AddWordForm_caption__Ybb5y",asterisk:"AddWordForm_asterisk__D6XWX",button:"AddWordForm_button__eQWs4",buttonInactive:"AddWordForm_buttonInactive__EVScR",success:"AddWordForm_success__oroQ-",error:"AddWordForm_error__5DqMM"};var g=r(579);const v={english:{label:"\u0421\u043b\u043e\u0432\u043e (\u0430\u043d\u0433\u043b.)",rules:["required","englishWord"]},transcription:{label:"\u0422\u0440\u0430\u043d\u0441\u043a\u0440\u0438\u043f\u0446\u0438\u044f",rules:["required","transcription"]},russian:{label:"\u041f\u0435\u0440\u0435\u0432\u043e\u0434",rules:["required","russianWord"]},tags:{label:"\u0422\u0435\u043c\u0430",rules:[]}};function S(){const t=(0,i.jE)(),[e,r,c]=function(t){const[e,r]=(0,s.useState)(t);return[e,t=>{const{name:e,value:s}=t.target;r(t=>(0,n.A)((0,n.A)({},t),{},{[e]:s}))},()=>r(t)]}(Object.keys(v).reduce((t,e)=>(0,n.A)((0,n.A)({},t),{},{[e]:""}),{})),{errors:l,validateForm:d}=function(t,e){const[r,n]=(0,s.useState)({}),i=(0,s.useCallback)(r=>{const{rules:s=[]}=t[r]||{};for(const t of s){var n;const s="string"===typeof t?_[t]:"function"===typeof t?t:null;if(!s)continue;const i=s(null!==(n=e[r])&&void 0!==n?n:"");if(i)return i}return null},[t,e]),o=(0,s.useCallback)(()=>{const e={};return Object.keys(t).forEach(t=>{const r=i(t);r&&(e[t]=r)}),n(e),0===Object.keys(e).length},[t,i]);return{errors:r,validateField:i,validateForm:o}}(v,e),[h,p]=(0,s.useState)(!1),[m,f]=(0,s.useState)(""),[S,W]=(0,s.useState)(!1),R=(0,o.n)({mutationFn:a.KW,onMutate:async e=>{var r;await t.cancelQueries({queryKey:u.e.WORDS_FULL});const s=null!==(r=t.getQueryData(u.e.WORDS_FULL))&&void 0!==r?r:[],i=(0,n.A)((0,n.A)({},e),{},{id:Date.now(),__temp:!0});return t.setQueryData(u.e.WORDS_FULL,[...s,i]),{prev:s,tempId:i.id}},onError:(e,r,s)=>{(null===s||void 0===s?void 0:s.prev)&&t.setQueryData(u.e.WORDS_FULL,s.prev),f("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u043b\u043e\u0432\u043e")},onSuccess:(e,r,s)=>{t.setQueryData(u.e.WORDS_FULL,function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter(t=>t.id!==(null===s||void 0===s?void 0:s.tempId))}),p(!0),c(),W(!1)},onSettled:()=>{t.invalidateQueries({queryKey:u.e.WORDS_FULL})}});return(0,g.jsxs)("form",{onSubmit:t=>{if(t.preventDefault(),p(!1),f(""),!d())return W(!0),void f("\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0437\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0432\u0441\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u043e\u043b\u044f");R.mutate(e)},className:b.form,noValidate:!0,children:[Object.entries(v).map(t=>{let[s,{label:n,rules:i}]=t;const o=i.includes("required"),a=S&&l[s];return(0,g.jsxs)("label",{className:b.field,children:[(0,g.jsxs)("span",{className:b.caption,children:[n,o&&(0,g.jsx)("span",{className:b.asterisk,children:"*"}),":"]}),(0,g.jsx)("input",{name:s,value:e[s],onChange:r,className:"".concat(b.input," ").concat(a?b.errorInput:"")}),a&&(0,g.jsx)("span",{className:b.errorNote,children:l[s]})]},s)}),(0,g.jsx)("button",{type:"submit",disabled:R.isPending,className:"".concat(b.button," ").concat(Object.keys(l).length?b.buttonInactive:""),children:R.isPending?"\u0414\u043e\u0431\u0430\u0432\u043b\u044f\u044e\u2026":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}),h&&(0,g.jsx)("p",{className:b.success,children:"\u2705 \u0414\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u043e!"}),m&&(0,g.jsxs)("p",{className:b.error,children:["\u274c ",m]})]})}const W={addWordPage:"AddWordPage_addWordPage__WFs9K",title:"AddWordPage_title__JXZ2w",formWrapper:"AddWordPage_formWrapper__S9MIc"};function R(){return(0,g.jsxs)("div",{className:W.addWordPage,children:[(0,g.jsx)("h2",{className:W.title,children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043d\u043e\u0432\u043e\u0435 \u0441\u043b\u043e\u0432\u043e"}),(0,g.jsx)("div",{className:W.formWrapper,children:(0,g.jsx)(S,{})})]})}},2836:(t,e,r)=>{r.d(e,{n:()=>p});var s=r(2555),n=r(5043),i=r(8664),o=r(116),a=r(9939),u=r(2078);class c extends u.Q{constructor(t,e){super(),this.client=t,this.setOptions(e),this.bindMethods(),this.updateResult()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var e;const r=this.options;this.options=this.client.defaultMutationOptions(t),(0,i.f8)(r,this.options)||this.client.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.currentMutation,observer:this}),null==(e=this.currentMutation)||e.setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(null==(t=this.currentMutation)||t.removeObserver(this))}onMutationUpdate(t){this.updateResult();const e={listeners:!0};"success"===t.type?e.onSuccess=!0:"error"===t.type&&(e.onError=!0),this.notify(e)}getCurrentResult(){return this.currentResult}reset(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})}mutate(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,(0,s.A)((0,s.A)({},this.options),{},{variables:"undefined"!==typeof t?t:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()}updateResult(){const t=this.currentMutation?this.currentMutation.state:(0,o.$)(),e="loading"===t.status,r=(0,s.A)((0,s.A)({},t),{},{isLoading:e,isPending:e,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset});this.currentResult=r}notify(t){a.j.batch(()=>{var e,r,s,n;if(this.mutateOptions&&this.hasListeners())if(t.onSuccess)null==(e=(r=this.mutateOptions).onSuccess)||e.call(r,this.currentResult.data,this.currentResult.variables,this.currentResult.context),null==(s=(n=this.mutateOptions).onSettled)||s.call(n,this.currentResult.data,null,this.currentResult.variables,this.currentResult.context);else if(t.onError){var i,o,a,u;null==(i=(o=this.mutateOptions).onError)||i.call(o,this.currentResult.error,this.currentResult.variables,this.currentResult.context),null==(a=(u=this.mutateOptions).onSettled)||a.call(u,void 0,this.currentResult.error,this.currentResult.variables,this.currentResult.context)}t.listeners&&this.listeners.forEach(t=>{let{listener:e}=t;e(this.currentResult)})})}}var l=r(8873),d=r(9781),h=r(4084);function p(t,e,r){const o=(0,i.GR)(t,e,r),u=(0,d.jE)({context:o.context}),[p]=n.useState(()=>new c(u,o));n.useEffect(()=>{p.setOptions(o)},[p,o]);const f=(0,l.r)(n.useCallback(t=>p.subscribe(a.j.batchCalls(t)),[p]),()=>p.getCurrentResult(),()=>p.getCurrentResult()),_=n.useCallback((t,e)=>{p.mutate(t,e).catch(m)},[p]);if(f.error&&(0,h.G)(p.options.useErrorBoundary,[f.error]))throw f.error;return(0,s.A)((0,s.A)({},f),{},{mutate:_,mutateAsync:f.mutate})}function m(){}},4834:(t,e,r)=>{r.d(e,{e:()=>s});const s={WORDS:["words"],WORDS_FULL:["wordsFull"],TRAIN_WORDS:["trainWords"],VOCAB_WORDS:["vocabWords"]}},5207:(t,e,r)=>{r.d(e,{Kk:()=>c,KW:()=>m,I0:()=>_,qi:()=>b,ob:()=>f});var s=r(2555),n=r(9722);function i(t){try{return JSON.parse(localStorage.getItem(t))||[]}catch(e){return[]}}function o(t,e){localStorage.setItem(t,JSON.stringify(e))}const a="https://flashcards-api-snowy-mountain-4760.fly.dev",u="addedWords",c="deletedWords",l=()=>n.A.get("".concat(a,"/words")).then(t=>t.data),d=t=>n.A.post("".concat(a,"/words"),t).then(t=>t.data),h=t=>n.A.put("".concat(a,"/words/").concat(t.id),t).then(t=>t.data),p=t=>n.A.delete("".concat(a,"/words/").concat(t));async function m(t){try{const e=await d(t);if(null!=(null===e||void 0===e?void 0:e.id)){const r=i(u).filter(e=>String(e.english).toLowerCase()!==t.english.toLowerCase());return o(u,r),e}}catch(n){}const e=(0,s.A)({id:"local-".concat(Date.now())},t),r=i(u);return o(u,[...r,e]),e}async function f(t){const e=await h(t),r="number"===typeof e.id?e.id:t.id,n=(0,s.A)({id:r},t),a=i(u).filter(t=>String(t.id)!==String(r));return o(u,[...a,n]),n}async function _(t){String(t).startsWith("local-")||await p(t);const e=i(u).filter(e=>String(e.id)!==String(t));o(u,e);const r=i(c);return r.includes(String(t))||o(c,[...r,String(t)]),t}async function b(){const t=await l(),e=i(c),r=i(u),s=t.filter(t=>!e.includes(String(t.id)));return[...s.map(t=>r.find(e=>String(e.id)===String(t.id))||t),...r.filter(t=>!s.find(e=>String(e.id)===String(t.id)))]}}}]);
//# sourceMappingURL=774.d0ddd564.chunk.js.map